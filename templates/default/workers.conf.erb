# Generated by Chef. Changes will be overwritten.
# Obtained from: https://github.com/mperham/sidekiq/blob/v5.1.3/examples/upstart/workers.conf

# /etc/init/workers.conf - manage a set of Sidekiqs

# This example config should work with Ubuntu 12.04+.  It
# allows you to manage multiple Sidekiq instances with
# Upstart, Ubuntu's native service management tool.
#
# See sidekiq.conf for how to manage a single Sidekiq instance.
#
# Use "stop workers" to stop all Sidekiq instances.
# Use "start workers" to start all instances.
# Use "restart workers" to restart all instances.
# Crazy, right?
#

description "manages the set of sidekiq processes"

# This starts upon bootup (may depend on Redis) and stops on shutdown
start on <%= @dependency[:upstart] ? "started #{@dependency[:upstart]}" : 'runlevel [2345]' %>
stop on runlevel [06]

# Set this to the number of Sidekiq processes you want
# to run on this machine
env NUM_WORKERS=<%= @workers %>

pre-start script
  for i in `seq 1 ${NUM_WORKERS}`
  do
    start sidekiq index=$i
  done
end script

post-stop script
  for i in `seq 1 ${NUM_WORKERS}`
  do
    stop sidekiq index=$i
  done
end script
